import 'mocha';
import {expect} from 'chai';
import {addition, explode, magnitude, part1, part2, readFile, reduce, split} from './index';

describe('AoC 2021: day18', function () {
  it('explode', () => {
    expect(explode('[[[[[9,8],1],2],3],4]'), '[[[[[9,8],1],2],3],4] => [[[[0,9],2],3],4]').to.equal('[[[[0,9],2],3],4]');
    expect(explode('[7,[6,[5,[4,[3,2]]]]]'), '[7,[6,[5,[4,[3,2]]]]] => [7,[6,[5,[7,0]]]]').to.equal('[7,[6,[5,[7,0]]]]');
    expect(explode('[[6,[5,[4,[3,2]]]],1]'), '[[6,[5,[4,[3,2]]]],1] => [[6,[5,[7,0]]],3]').to.equal('[[6,[5,[7,0]]],3]');
    expect(explode('[[3,[2,[1,[7,3]]]],[6,[5,[4,[3,2]]]]]'), '[[3,[2,[1,[7,3]]]],[6,[5,[4,[3,2]]]]] => [[3,[2,[8,0]]],[9,[5,[4,[3,2]]]]]').to.equal('[[3,[2,[8,0]]],[9,[5,[4,[3,2]]]]]');
    // step two from above
    expect(explode('[[3,[2,[8,0]]],[9,[5,[4,[3,2]]]]]'), '[[3,[2,[8,0]]],[9,[5,[4,[3,2]]]]] => [[3,[2,[8,0]]],[9,[5,[7,0]]]]').to.equal('[[3,[2,[8,0]]],[9,[5,[7,0]]]]');
    expect(explode('[[3,[2,[8,0]]],[9,[5,[4,[3,2]]]]]'), '[[3,[2,[8,0]]],[9,[5,[4,[3,2]]]]] => [[3,[2,[8,0]]],[9,[5,[7,0]]]]').to.equal('[[3,[2,[8,0]]],[9,[5,[7,0]]]]');

    expect(explode('[[[[[4,3],4],4],[7,[[8,4],9]]],[1,1]]'), '[[[[[4,3],4],4],[7,[[8,4],9]]],[1,1]] => [[[[0,7],4],[7,[[8,4],9]]],[1,1]]').to.equal('[[[[0,7],4],[7,[[8,4],9]]],[1,1]]');
    expect(explode('[[[[0,7],4],[7,[[8,4],9]]],[1,1]]'), '[[[[0,7],4],[7,[[8,4],9]]],[1,1]] => [[[[0,7],4],[15,[0,13]]],[1,1]]').to.equal('[[[[0,7],4],[15,[0,13]]],[1,1]]');
    expect(explode('[[[[0,7],4],[15,[0,13]]],[1,1]]'), '[[[[0,7],4],[15,[0,13]]],[1,1]] => [[[[0,7],4],[15,[0,13]]],[1,1]]').to.equal('[[[[0,7],4],[15,[0,13]]],[1,1]]');

    expect(explode('[[[[0,[4,5]],[0,0]],[[[4,5],[2,6]],[9,5]]],[7,[[[3,7],[4,3]],[[6,3],[8,8]]]]]')).to.equal('[[[[4,0],[5,0]],[[[4,5],[2,6]],[9,5]]],[7,[[[3,7],[4,3]],[[6,3],[8,8]]]]]');
    expect(explode('[[[[4,0],[5,0]],[[[4,5],[2,6]],[9,5]]],[7,[[[3,7],[4,3]],[[6,3],[8,8]]]]]')).to.equal('[[[[4,0],[5,4]],[[0,[7,6]],[9,5]]],[7,[[[3,7],[4,3]],[[6,3],[8,8]]]]]');

    expect(explode('[[[[12,12],[6,14]],[[15,0],[17,[8,1]]]],[2,9]]')).to.equal('[[[[12,12],[6,14]],[[15,0],[25,0]]],[3,9]]');
  });


  it ('split', () => {
    expect(split('[10]')).to.equal('[[5,5]]');
    expect(split('[11]')).to.equal('[[5,6]]');
    expect(split('[12]')).to.equal('[[6,6]]');
    expect(split('[12,2]')).to.equal('[[6,6],2]');
  });

  it('reduce', () => {
    expect(reduce('[[[[4,3],4],4],[7,[[8,4],9]]]', '[1,1]'), '[[[[4,3],4],4],[7,[[8,4],9]]] + [1,1] => [[[[0,7],4],[[7,8],[6,0]]],[8,1]]').to.equal('[[[[0,7],4],[[7,8],[6,0]]],[8,1]]')
  });

  it('addition', () => {
    expect(addition(['[1,1]','[2,2]','[3,3]','[4,4]'])).to.equal('[[[[1,1],[2,2]],[3,3]],[4,4]]');
    expect(addition(['[1,1]','[2,2]','[3,3]','[4,4]','[5,5]'])).to.equal('[[[[3,0],[5,3]],[4,4]],[5,5]]');
    expect(addition(['[1,1]','[2,2]','[3,3]','[4,4]','[5,5]','[6,6]'])).to.equal('[[[[5,0],[7,4]],[5,5]],[6,6]]');
    expect(addition(['[[[0,[4,5]],[0,0]],[[[4,5],[2,6]],[9,5]]]','[7,[[[3,7],[4,3]],[[6,3],[8,8]]]]'])).to.equal('[[[[4,0],[5,4]],[[7,7],[6,0]]],[[8,[7,7]],[[7,9],[5,0]]]]');

    expect(addition(['[[[0,[4,5]],[0,0]],[[[4,5],[2,6]],[9,5]]]','[7,[[[3,7],[4,3]],[[6,3],[8,8]]]]'])).to.equal('[[[[4,0],[5,4]],[[7,7],[6,0]]],[[8,[7,7]],[[7,9],[5,0]]]]');
    expect(addition(['[[[[4,0],[5,4]],[[7,7],[6,0]]],[[8,[7,7]],[[7,9],[5,0]]]]','[[2,[[0,8],[3,4]]],[[[6,7],1],[7,[1,6]]]]'])).to.equal('[[[[6,7],[6,7]],[[7,7],[0,7]]],[[[8,7],[7,7]],[[8,8],[8,0]]]]');
    expect(addition(['[[[[6,7],[6,7]],[[7,7],[0,7]]],[[[8,7],[7,7]],[[8,8],[8,0]]]]','[[[[2,4],7],[6,[0,5]]],[[[6,8],[2,8]],[[2,1],[4,5]]]]'])).to.equal('[[[[7,0],[7,7]],[[7,7],[7,8]]],[[[7,7],[8,8]],[[7,7],[8,7]]]]');
    expect(addition(['[[[[7,0],[7,7]],[[7,7],[7,8]]],[[[7,7],[8,8]],[[7,7],[8,7]]]]','[7,[5,[[3,8],[1,4]]]]'])).to.equal('[[[[7,7],[7,8]],[[9,5],[8,7]]],[[[6,8],[0,8]],[[9,9],[9,0]]]]');
    expect(addition(['[[[[7,7],[7,8]],[[9,5],[8,7]]],[[[6,8],[0,8]],[[9,9],[9,0]]]]','[[2,[2,2]],[8,[8,1]]]'])).to.equal('[[[[6,6],[6,6]],[[6,0],[6,7]]],[[[7,7],[8,9]],[8,[8,1]]]]');
    expect(addition(['[[[[6,6],[6,6]],[[6,0],[6,7]]],[[[7,7],[8,9]],[8,[8,1]]]]','[2,9]'])).to.equal('[[[[6,6],[7,7]],[[0,7],[7,7]]],[[[5,5],[5,6]],9]]');
    expect(addition(['[[[[6,6],[7,7]],[[0,7],[7,7]]],[[[5,5],[5,6]],9]]','[1,[[[9,3],9],[[9,0],[0,7]]]]'])).to.equal('[[[[7,8],[6,7]],[[6,8],[0,8]]],[[[7,7],[5,0]],[[5,5],[5,6]]]]');
    expect(addition(['[[[[7,8],[6,7]],[[6,8],[0,8]]],[[[7,7],[5,0]],[[5,5],[5,6]]]]','[[[5,[7,4]],7],1]'])).to.equal('[[[[7,7],[7,7]],[[8,7],[8,7]]],[[[7,0],[7,7]],9]]');
    expect(addition(['[[[[7,7],[7,7]],[[8,7],[8,7]]],[[[7,0],[7,7]],9]]','[[[[4,2],2],6],[8,7]]'])).to.equal('[[[[8,7],[7,7]],[[8,6],[7,7]]],[[[0,7],[6,6]],[8,7]]]');

    expect(addition(readFile('input.training.txt'))).to.equal('[[[[8,7],[7,7]],[[8,6],[7,7]]],[[[0,7],[6,6]],[8,7]]]');

  });

  it('magnitude', () => {
    expect(magnitude('[[1,2],[[3,4],5]]')).to.equal(143);
    expect(magnitude('[[[[0,7],4],[[7,8],[6,0]]],[8,1]]')).to.equal(1384);
    expect(magnitude('[[[[1,1],[2,2]],[3,3]],[4,4]]')).to.equal(445);
    expect(magnitude('[[[[3,0],[5,3]],[4,4]],[5,5]]')).to.equal(791);
    expect(magnitude('[[[[5,0],[7,4]],[5,5]],[6,6]]')).to.equal(1137);
    expect(magnitude('[[[[8,7],[7,7]],[[8,6],[7,7]]],[[[0,7],[6,6]],[8,7]]]')).to.equal(3488);
  });

  it('part1', () => {
    expect(part1(readFile('input.training.txt')), 'part1: input.training.txt').to.equal(3488);
    expect(part1(readFile('input.example.txt')), 'part1: input.example.txt').to.equal(4140);
    expect(part1(readFile('input.txt')), 'part1: input.txt').to.equal(3411);
  });

  it('part2', () => {
    expect(part2(readFile('input.example.txt')), 'part2: input.example.txt').to.equal(3993);
    expect(part2(readFile('input.txt')), 'part2: input.txt').to.equal(4680);
  });
});
